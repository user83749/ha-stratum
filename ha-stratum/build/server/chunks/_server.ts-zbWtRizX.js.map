{"version":3,"file":"_server.ts-zbWtRizX.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/ha/test/_server.ts.js"],"sourcesContent":["import { error, json } from \"@sveltejs/kit\";\nfunction normalizeBaseUrl(raw) {\n  try {\n    const url = new URL(raw.trim());\n    if (url.protocol !== \"http:\" && url.protocol !== \"https:\") {\n      throw new Error(\"Invalid protocol\");\n    }\n    url.pathname = url.pathname.replace(/\\/$/, \"\");\n    url.search = \"\";\n    url.hash = \"\";\n    return url.toString().replace(/\\/$/, \"\");\n  } catch {\n    error(400, \"Invalid Home Assistant URL\");\n  }\n}\nconst POST = async ({ request, fetch }) => {\n  let body;\n  try {\n    body = await request.json();\n  } catch {\n    error(400, \"Invalid JSON body\");\n  }\n  const baseUrl = normalizeBaseUrl(body.url ?? \"\");\n  const token = (body.token ?? \"\").trim();\n  if (!token) {\n    error(400, \"Access token is required\");\n  }\n  const response = await fetch(`${baseUrl}/api/`, {\n    headers: {\n      Authorization: `Bearer ${token}`,\n      \"Content-Type\": \"application/json\"\n    }\n  });\n  if (!response.ok) {\n    error(response.status, \"Unable to connect to Home Assistant\");\n  }\n  return json({ ok: true });\n};\nexport {\n  POST\n};\n"],"names":[],"mappings":";;AACA,SAAS,gBAAgB,CAAC,GAAG,EAAE;AAC/B,EAAE,IAAI;AACN,IAAI,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;AACnC,IAAI,IAAI,GAAG,CAAC,QAAQ,KAAK,OAAO,IAAI,GAAG,CAAC,QAAQ,KAAK,QAAQ,EAAE;AAC/D,MAAM,MAAM,IAAI,KAAK,CAAC,kBAAkB,CAAC;AACzC,IAAI;AACJ,IAAI,GAAG,CAAC,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC;AAClD,IAAI,GAAG,CAAC,MAAM,GAAG,EAAE;AACnB,IAAI,GAAG,CAAC,IAAI,GAAG,EAAE;AACjB,IAAI,OAAO,GAAG,CAAC,QAAQ,EAAE,CAAC,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC;AAC5C,EAAE,CAAC,CAAC,MAAM;AACV,IAAI,KAAK,CAAC,GAAG,EAAE,4BAA4B,CAAC;AAC5C,EAAE;AACF;AACK,MAAC,IAAI,GAAG,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK;AAC3C,EAAE,IAAI,IAAI;AACV,EAAE,IAAI;AACN,IAAI,IAAI,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE;AAC/B,EAAE,CAAC,CAAC,MAAM;AACV,IAAI,KAAK,CAAC,GAAG,EAAE,mBAAmB,CAAC;AACnC,EAAE;AACF,EAAE,MAAM,OAAO,GAAG,gBAAgB,CAAC,IAAI,CAAC,GAAG,IAAI,EAAE,CAAC;AAClD,EAAE,MAAM,KAAK,GAAG,CAAC,IAAI,CAAC,KAAK,IAAI,EAAE,EAAE,IAAI,EAAE;AACzC,EAAE,IAAI,CAAC,KAAK,EAAE;AACd,IAAI,KAAK,CAAC,GAAG,EAAE,0BAA0B,CAAC;AAC1C,EAAE;AACF,EAAE,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,CAAC,EAAE,OAAO,CAAC,KAAK,CAAC,EAAE;AAClD,IAAI,OAAO,EAAE;AACb,MAAM,aAAa,EAAE,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;AACtC,MAAM,cAAc,EAAE;AACtB;AACA,GAAG,CAAC;AACJ,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE;AACpB,IAAI,KAAK,CAAC,QAAQ,CAAC,MAAM,EAAE,qCAAqC,CAAC;AACjE,EAAE;AACF,EAAE,OAAO,IAAI,CAAC,EAAE,EAAE,EAAE,IAAI,EAAE,CAAC;AAC3B;;;;"}