import{b as f,f as k,g as at}from"./CHLJW1vT.js";import{p as _t,d as v,g as t,r as n,t as F,b as gt,X as l,c as y}from"./BFobMjM6.js";import{s as x}from"./CbAumXQD.js";import{i as V}from"./DtaZhLEA.js";import{s as dt,f as N,g as ht}from"./CoH-M4O8.js";var pt=at('<path class="gauge-fg svelte-1aulvsm"></path>'),yt=k('<span class="label svelte-1aulvsm"> </span>'),ft=k('<div class="gauge-layout svelte-1aulvsm"><svg viewBox="0 0 100 55" class="gauge-svg svelte-1aulvsm"><path class="gauge-bg svelte-1aulvsm"></path><!><text x="50" y="41" class="gauge-val svelte-1aulvsm"> </text><text x="50" y="51" class="gauge-unit svelte-1aulvsm"> </text></svg> <!></div>'),xt=k('<span class="history-name svelte-1aulvsm"> </span>'),bt=at('<svg viewBox="0 0 100 40" class="spark-svg svelte-1aulvsm" preserveAspectRatio="none"><polygon class="spark-area svelte-1aulvsm"></polygon><polyline class="spark-line svelte-1aulvsm"></polyline></svg>'),Mt=k('<span class="no-data svelte-1aulvsm">No history data</span>'),Ft=k('<div class="history-meta svelte-1aulvsm"><span class="history-chip svelte-1aulvsm"> </span> <span class="history-chip svelte-1aulvsm"> </span></div>'),wt=k('<div class="history-layout svelte-1aulvsm"><div class="history-header svelte-1aulvsm"><span class="history-value svelte-1aulvsm"> <span class="history-unit svelte-1aulvsm"> </span></span> <!></div> <div class="spark-wrap svelte-1aulvsm"><!></div> <!></div>'),kt=k('<span class="label svelte-1aulvsm"> </span>'),Pt=k('<span class="stat-meta svelte-1aulvsm"> </span>'),Vt=k('<div class="stat-layout svelte-1aulvsm"><span class="stat-value svelte-1aulvsm"> <span class="stat-unit svelte-1aulvsm"> </span></span> <!> <!></div>'),zt=k("<div><!></div>");function St(st,r){_t(r,!0);const T=l(()=>r.tile.layout?.w??r.tile.size?.w??1),j=l(()=>r.tile.layout?.h??r.tile.size?.h??1),S=l(()=>t(T)>=4&&t(j)>=3?"xl":t(T)>=3&&t(j)>=2?"lg":t(T)>=2||t(j)>=2?"md":"sm");let H=l(()=>r.mode??r.tile.config.graph_mode??"history"),I=l(()=>r.tile.config.name??r.entity?.attributes.friendly_name??"Graph"),z=l(()=>r.tile.config.unit_of_measurement??r.entity?.attributes.unit_of_measurement??""),E=l(()=>r.entity&&parseFloat(r.entity.state)||0),B=l(()=>t(H)==="statistic"?r.statisticValue??t(E):t(E)),L=l(()=>r.tile.config.min??0),J=l(()=>r.tile.config.max??100),K=l(()=>Math.min(100,Math.max(0,(t(B)-t(L))/(t(J)-t(L))*100))),et=l(()=>{const a=r.tile.config.gauge_segments;if(!a||a.length===0)return"var(--accent)";const e=[...a].sort((i,o)=>i.from-o.from);let s=e[0].color;for(const i of e)t(B)>=i.from&&(s=i.color);return s}),A=l(()=>(r.history??[]).slice(-50)),lt=l(()=>r.entity?.state==="unavailable"||r.entity?.state==="unknown"),O=l(()=>{const a=t(A);if(a.length<2)return{polyline:"",polygon:""};const e=a.map(p=>p.v),s=Math.min(...e),o=Math.max(...e)-s||1,b=100,u=40,g=2,M=a.map((p,G)=>{const c=g+G/(a.length-1)*(b-g*2),_=u-g-(p.v-s)/o*(u-g*2);return c.toFixed(2)+","+_.toFixed(2)}),w=M.join(" "),d=M[0].split(","),h=M[M.length-1].split(","),m=w+" "+h[0]+","+(u-g)+" "+d[0]+","+(u-g);return{polyline:w,polygon:m}});function Q(a,e,s,i){const o=(i-90)*Math.PI/180;return{x:a+s*Math.cos(o),y:e+s*Math.sin(o)}}function U(a,e,s,i,o){const b=Q(a,e,s,i),u=Q(a,e,s,o),g=o-i>180?1:0;return"M "+b.x.toFixed(2)+" "+b.y.toFixed(2)+" A "+s+" "+s+" 0 "+g+" 1 "+u.x.toFixed(2)+" "+u.y.toFixed(2)}let vt=l(()=>U(50,50,38,180,360)),Y=l(()=>{if(t(K)<=0)return"";const a=180+t(K)*1.8;return U(50,50,38,180,Math.min(360,a))}),R=l(()=>Number.isFinite(t(B))?t(B).toFixed(t(B)%1===0?0:1):"—"),W=l(()=>t(S)!=="sm"),Z=l(()=>t(S)==="lg"||t(S)==="xl"),X=l(()=>t(A).length?Math.min(...t(A).map(a=>a.v)):null),q=l(()=>t(A).length?Math.max(...t(A).map(a=>a.v)):null);var C=zt();let $;var nt=v(C);{var rt=a=>{var e=ft(),s=v(e),i=v(s),o=y(i);{var b=m=>{var p=pt();F(()=>{N(p,"d",t(Y)),ht(p,`stroke: ${t(et)??""}`)}),f(m,p)};V(o,m=>{t(Y)&&m(b)})}var u=y(o),g=v(u,!0);n(u);var M=y(u),w=v(M,!0);n(M),n(s);var d=y(s,2);{var h=m=>{var p=yt(),G=v(p,!0);n(p),F(()=>x(G,t(I))),f(m,p)};V(d,m=>{t(W)&&m(h)})}n(e),F(()=>{N(i,"d",t(vt)),x(g,t(R)),x(w,t(z))}),f(a,e)},it=a=>{var e=wt(),s=v(e),i=v(s),o=v(i,!0),b=y(o),u=v(b,!0);n(b),n(i);var g=y(i,2);{var M=c=>{var _=xt(),P=v(_,!0);n(_),F(()=>x(P,t(I))),f(c,_)};V(g,c=>{t(W)&&c(M)})}n(s);var w=y(s,2),d=v(w);{var h=c=>{var _=bt(),P=v(_),D=y(P);n(_),F(()=>{N(P,"points",t(O).polygon),N(D,"points",t(O).polyline)}),f(c,_)},m=c=>{var _=Mt();f(c,_)};V(d,c=>{t(A).length>=2?c(h):c(m,!1)})}n(w);var p=y(w,2);{var G=c=>{var _=Ft(),P=v(_),D=v(P);n(P);var tt=y(P,2),ut=v(tt);n(tt),n(_),F((ct,mt)=>{x(D,`Min ${ct??""}${t(z)??""}`),x(ut,`Max ${mt??""}${t(z)??""}`)},[()=>t(X).toFixed(t(X)%1===0?0:1),()=>t(q).toFixed(t(q)%1===0?0:1)]),f(c,_)};V(p,c=>{t(Z)&&t(X)!==null&&t(q)!==null&&c(G)})}n(e),F(()=>{x(o,t(R)),x(u,t(z))}),f(a,e)},ot=a=>{var e=Vt(),s=v(e),i=v(s,!0),o=y(i),b=v(o,!0);n(o),n(s);var u=y(s,2);{var g=d=>{var h=kt(),m=v(h,!0);n(h),F(()=>x(m,t(I))),f(d,h)};V(u,d=>{t(W)&&d(g)})}var M=y(u,2);{var w=d=>{var h=Pt(),m=v(h);n(h),F(()=>x(m,`${t(L)??""}–${t(J)??""}${t(z)??""}`)),f(d,h)};V(M,d=>{t(Z)&&d(w)})}n(e),F(()=>{x(i,t(R)),x(b,t(z))}),f(a,e)};V(nt,a=>{t(H)==="gauge"?a(rt):t(H)==="history"?a(it,1):a(ot,!1)})}n(C),F(()=>{$=dt(C,1,"graph-tile svelte-1aulvsm",null,$,{unavailable:t(lt)}),N(C,"data-size",t(S))}),f(st,C),gt()}export{St as default};
